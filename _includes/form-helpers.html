{% comment %}
  Form helpers, including parsley.js and some baked-in validation
{% endcomment %}

<!-- Some custom configuration for parsley -->
<script>
  // Global configuration for parsley, see http://parsleyjs.org/doc/annotated-source/defaults.htm
  window.ParsleyConfig = {
    trigger:        'change, focusout',
    errorClass:     'invalid',
    successClass:   'valid',
    errorsWrapper:  '<div></div>',
    errorTemplate:  '<span class="note text-invalid"></span>',
  };
</script>

<!-- parsley needs to be loaded here, after the global configuration -->
<script src="//cdnjs.cloudflare.com/ajax/libs/parsley.js/2.0.6/parsley.min.js"></script>

<!-- Rewrite some parsley error messages -->
<script>
  window.ParsleyConfig.i18n.en = $.extend(window.ParsleyConfig.i18n.en || {}, {
    defaultMessage: "This value seems to be invalid.",
    type: {
      email:        "Enter a valid email address (i.e. email@domain.com).",
      url:          "This value should be a valid url.",
      number:       "This value should be a valid number.",
      integer:      "This value should be a valid integer.",
      digits:       "This value should be digits.",
      alphanum:     "This value should be alphanumeric."
    },
    notblank:       "This field is required. Please fill it in.",
    required:       "This field is required. Please fill it in.",
    pattern:        "This value seems to be invalid.",
    min:            "This value should be greater than or equal to %s.",
    max:            "This value should be lower than or equal to %s.",
    range:          "This value should be between %s and %s.",
    minlength:      "This value is too short. It should have %s characters or more.",
    maxlength:      "This value is too long. It should have %s characters or fewer.",
    length:         "This value length is invalid. It should be between %s and %s characters long.",
    mincheck:       "You must select at least %s choices.",
    maxcheck:       "You must select %s choices or fewer.",
    check:          "You must select between %s and %s choices.",
    equalto:        "This value should be the same."
  });

  if ('undefined' !== typeof window.ParsleyValidator)
    window.ParsleyValidator.addCatalog('en', window.ParsleyConfig.i18n.en, true);
</script>

<script>
  $(document).ready(function(){
    if ($('#timestamp').length){ 
      /* Put current date + time into the form */
      var currentDate = new Date();
      document.getElementById("timestamp").value = currentDate;
    }

    var documentReferrer = document.referrer;

    if ($('#data-document-referrer').length){ 
      var documentReferrer = document.referrer;
      $('#data-document-referrer').val(documentReferrer);
    }

    if ($('#data-document-referrer').length){ 
      var externalReferrer = localStorage.getItem('externalReferrer');
      $('#data-external-referrer').val(externalReferrer);
    }

  });
</script>